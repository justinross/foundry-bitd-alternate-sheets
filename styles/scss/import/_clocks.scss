// ================================================================
// GLOBAL CLOCK STYLES
// ================================================================
// These styles ensure .blades-clock elements work consistently
// across ALL contexts: character sheets, crew sheets, journals,
// chat messages, and enriched text fields.
// This file is loaded at the TOP LEVEL (outside .blades-alt namespace)
// to ensure clocks render correctly everywhere in Foundry.
// ================================================================

@use "sass:math";
@use "../variables" as *;

// Clock container styling for enriched/linked clocks
.blades-clock-container {
  display: inline-block;
  text-align: center;
  vertical-align: middle;

  .clock-label,
  .clock-name {
    display: block;
    font-weight: bold;
    margin-top: 4px;
  }
}

// Linked clock styling (from @UUID enricher)
.linkedClock {
  display: inline-block;
  text-align: center;
  margin: 0.5em;
}

// Clock images (legacy support)
.clockImage {
  width: 100px;
  border: none;
}

// Base clock element - uses background-image from Handlebars helper
.blades-clock {
  position: relative;
  padding: 0;
  border-radius: 50%;
  list-style: none;
  overflow: hidden;
  background-size: cover;
  background-repeat: no-repeat;
  background-position: center;

  // Hide radio inputs
  input[type="radio"] {
    position: absolute;
    display: none;
  }

  // Interactive labels (click targets for segments)
  label.radio-toggle {
    overflow: hidden;
    position: absolute;
    top: -50%;
    right: -50%;
    width: 100%;
    height: 100%;
    transform-origin: 0% 100%;
    cursor: pointer;
    transition: filter 0.1s;
    // Transparent background - the clock image shows through
    background-color: transparent;

    &:hover {
      filter: brightness(0.85);
      background-color: rgba(255, 255, 255, 0.1);
    }
  }
}

// Hide the zero-value label (usually placed outside the clock div)
label.clock-zero-label {
  display: none;
}

// Nullifier icon styling
i.nullifier {
  cursor: pointer;
  transition: color 0.1s;

  &:hover {
    color: $red;
  }
}

// ================================================================
// CLOCK SIZE VARIANTS WITH SEGMENT TRANSFORMS
// ================================================================
// Each size variant generates the correct rotation/skew for its segments.
// The nth-child selector targets labels based on their position in the DOM.
// Structure: input, label, input, label... so labels are at positions 3, 5, 7...
// nth-child(i * 2 + 1) gives us: 3, 5, 7, 9... for i = 1, 2, 3, 4...

// Mixin to generate clock segment transforms
@mixin clock-segments($segments, $size) {
  $angle: math.div(360, $segments);
  $skew: 90 + $angle;

  width: #{$size}px;
  height: #{$size}px;

  @for $i from 1 through $segments {
    $rotate_angle: $angle * ($i - 1);

    // Target the label at position (i * 2 + 1) - accounting for input/label pairs
    *:nth-child(#{$i * 2 + 1}) {
      transform: rotate(#{$rotate_angle}deg) skewY(#{$skew}deg);
    }
  }
}

// ================================================================
// SIZE OVERRIDES FOR SPECIFIC CONTEXTS
// ================================================================
// Note: We do NOT define global 50px clock sizes here.
// The base system handles clock sizing for item sheets.
// We only override for specific module contexts below.

// Larger clocks for embedded/enriched content (100px)
.linkedClock .blades-clock,
.blades-clock-container .blades-clock {
  width: 100px;
  height: 100px;
}

// Re-apply transforms at 100px size for enriched clocks
.linkedClock .blades-clock.clock-4,
.blades-clock-container .blades-clock.clock-4 {
  @include clock-segments(4, 100);
}

.linkedClock .blades-clock.clock-6,
.blades-clock-container .blades-clock.clock-6 {
  @include clock-segments(6, 100);
}

.linkedClock .blades-clock.clock-8,
.blades-clock-container .blades-clock.clock-8 {
  @include clock-segments(8, 100);
}

.linkedClock .blades-clock.clock-10,
.blades-clock-container .blades-clock.clock-10 {
  @include clock-segments(10, 100);
}

.linkedClock .blades-clock.clock-12,
.blades-clock-container .blades-clock.clock-12 {
  @include clock-segments(12, 100);
}

// Crew XP clock - gray circular background
.crew-xp-clock-wrapper {
  flex-shrink: 0;
  position: relative;
  background-color: #888;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 5px; // Consistent padding around 40px clock
}

.crew-xp-clock .blades-clock {
  &.clock-4 {
    @include clock-segments(4, 40);
  }

  &.clock-6 {
    @include clock-segments(6, 40);
  }

  &.clock-8 {
    @include clock-segments(8, 40);
  }

  &.clock-10 {
    @include clock-segments(10, 40);
  }

  &.clock-12 {
    @include clock-segments(12, 40);
  }
}
